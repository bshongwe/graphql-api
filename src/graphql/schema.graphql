extend schema
  @link(url: "https://specs.apollo.dev/federation/v2.3", import: ["@key", "@shareable", "@provides", "@requires", "@external", "@tag", "@override", "@inaccessible"])

type Query {
  users: [User!]! @shareable
  user(id: ID!): User
  me: User
}

type Mutation {
  signUp(name: String!, email: String!, password: String!): AuthPayload!
  signIn(email: String!, password: String!): AuthPayload!
  updateUserProfile(name: String, email: String): User!
  deleteUser(id: ID!): Boolean!
}

type Subscription {
  userCreated: UserCreatedPayload!
  userUpdated(userId: ID): UserUpdatedPayload!
  userDeleted: UserDeletedPayload!
  userOnline(userId: ID): UserOnlinePayload!
}

type User @key(fields: "id") @key(fields: "email") {
  id: ID!
  name: String!
  email: String!
  role: String!
  createdAt: String! @shareable
}

type AuthPayload {
  token: String!
  user: User!
}

type UserCreatedPayload {
  user: User!
  timestamp: String!
}

type UserUpdatedPayload {
  user: User!
  previousValues: User
  timestamp: String!
}

type UserDeletedPayload {
  id: ID!
  email: String!
  timestamp: String!
}

type UserOnlinePayload {
  user: User!
  isOnline: Boolean!
  timestamp: String!
}
